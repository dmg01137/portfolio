<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.log.BehaviorLogDAO">

  <!-- ID로 조회 -->
<select id="findById" resultType="com.example.demo.dto.log.BehaviorLog" parameterType="int">
    SELECT * FROM log_db.behavior_log
    WHERE detection_number = #{detectionNumber}
</select>

<!-- 모든 데이터 조회 -->
<select id="findAll" resultType="com.example.demo.dto.log.BehaviorLog">
     SELECT * FROM log_db.behavior_log
</select>

<!-- 데이터 삽입 -->
<insert id="save" parameterType="com.example.demo.dto.log.BehaviorLog">
    INSERT INTO log_db.behavior_log (time, s_ip, d_ip, s_port, d_port, len, pattern1, pattern2, pattern3, packet, policy_name, count, detection_time)
    VALUES (#{time}, #{sIp}, #{dIp}, #{sPort}, #{dPort}, #{len}, #{pattern1}, #{pattern2}, #{pattern3}, #{packet}, #{policyName}, #{count}, #{detectionTime})
</insert>

<!-- 데이터 업데이트 -->
<update id="update" parameterType="com.example.demo.dto.log.BehaviorLog">
    UPDATE log_db.behavior_log
    SET time = #{time}, s_ip = #{sIp}, d_ip = #{dIp}, s_port = #{sPort}, d_port = #{dPort},
        len = #{len}, pattern1 = #{pattern1}, pattern2 = #{pattern2}, pattern3 = #{pattern3}, 
        packet = #{packet}, policy_name = #{policyName},
        count = #{count}, detection_time = #{detectionTime}
    WHERE detection_number = #{detectionNumber}
</update>

<!-- 데이터 삭제 -->
<delete id="delete" parameterType="int">
    DELETE FROM log_db.behavior_log WHERE detection_number = #{detectionNumber}
</delete>

<!-- 검색 -->
<select id="search" resultType="com.example.demo.dto.log.BehaviorLog">
    SELECT * FROM log_db.behavior_log
    WHERE 
    <if test="detectionNumber != null">
        detection_number = #{detectionNumber}
    </if>
    <if test="sIp != null and sIp != ''">
        AND s_ip = #{sIp}
    </if>
    <if test="sPort != null">
        AND s_port = #{sPort}
    </if>
    <if test="policyName != null and policyName != ''">
        AND policy_name = #{policyName}
    </if>
</select>

</mapper>
