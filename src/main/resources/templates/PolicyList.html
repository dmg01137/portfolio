<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pattern Policy</title>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
/* 네비게이션 바 스타일 */
.navbar {
	background-color: #222;
	padding: 14px 16px;
	box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
	position: fixed;
	width: 100%;
	top: 0;
	z-index: 1000; /* 다른 요소들보다 위에 표시되도록 설정 */
}

.navbar-brand {
	font-size: 1.5rem;
	color: #fff;
}

.navbar-nav .nav-item {
	margin-right: 10px;
}

.nav-link {
	color: #fff !important;
	transition: all 0.3s ease;
}

.nav-link:hover {
	color: #17a2b8 !important;
}

.nav-link i {
	margin-right: 5px;
}

.nav-sidebar .nav-link {
	color: #d1d1d1;
	padding: 10px 20px;
	transition: all 0.3s ease;
}

.nav-sidebar .nav-link:hover {
	background-color: #222;
	color: #fff;
}

.nav-sidebar .nav-link i {
	margin-right: 10px;
}

.nav-sidebar .nav-link-custom {
	color: #d1d1d1; /* 기본 텍스트 색상 */
	padding: 10px 20px;
	transition: all 0.3s ease;
}

.nav-sidebar .nav-link-custom:hover, .nav-sidebar .nav-link-custom:hover i
	{
	color: #17a2b8 !important; /* 호버 시 글자 및 아이콘 색상 변경 */
}

/* 왼쪽 세로 메뉴바 스타일 */
.sidebar {
	position: fixed;
	left: 0;
	top: 64px;
	width: 220px; /* 사이드바 너비를 220px로 조정 */
	background-color: #222;
	height: 100%;
	padding-top: 20px;
	transition: all 0.3s ease;
	box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
	overflow-x: hidden; /* 가로 스크롤바를 숨기는 속성 */
}

.sidebar-heading {
	font-size: 1.2rem;
	color: #fff;
	text-align: center;
	margin-bottom: 20px;
}

.nav-sidebar .nav-link.active {
	color: #17a2b8 !important; /* Active 상태에서의 텍스트 색상 변경 */
}

body {
	background-color: #f8f9fa;
	font-family: Arial, sans-serif;
	padding-top: 80px;
	/* 네비게이션 바가 fixed로 설정되어 있으므로 body의 padding-top 값을 설정하여 겹치지 않게 함 */
}

.container {
	margin-top: 0px; /* 기본적인 여백을 유지 */
	margin-left: 70px;
}

.card {
	margin-top: 0px; /* 카드의 위쪽 여백 설정 */
	margin-left: 150px; /* 카드를 가운데 정렬 */
	margin-right: auto; /* 카드를 가운데 정렬 */
	width: 90%; /* 카드의 너비를 조정 */
	max-width: 1100px; /* 카드의 최대 너비 설정 */
	border-radius: 15px;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	transition: all 0.3s ease-in-out;
	border: transparent; /* 테두리를 투명하게 설정 */
}

.card:hover {
	box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
}

.card-body {
	padding: 20px; /* 카드의 안쪽 여백 설정 */
	font-size: 13px; /* 글자 크기 조정 */
	word-break: break-word; /* 글자가 잘리지 않도록 설정 */
}

.form-group {
	margin-bottom: 20px; /* 폼 그룹 사이의 여백 설정 */
}

.nav-sidebar .nav-link-custom {
	color: #17a2b8 !important; /* 텍스트 색상 변경 */
}

.user-list {
	margin-top: 20px;
}

.user-list-item {
	padding: 15px;
	background-color: #fff;
	border: 1px solid #ddd;
	border-radius: 5px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	margin-bottom: 10px;
	cursor: pointer;
	transition: all 0.3s ease;
}

.user-list-item:hover {
	background-color: #f0f0f0;
	transform: translateY(-2px);
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
}

.btn-section {
	margin-top: 20px;
	text-align: center;
}

.btn-modify {
	margin-top: 10px;
}

/* 추가한 부분: 검색창 스타일 */
.search-section {
	margin-bottom: 20px;
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
	gap: 10px;
}

.search-section input[type="text"] {
	width: 100%;
	padding: 8px;
	font-size: 14px;
}

.search-section button {
	padding: 8px 16px;
	font-size: 14px;
}

/* 추가한 부분: 테이블 스타일 수정 */
.table-container {
	overflow-x: auto;
	max-width: 100%; /* 가로 스크롤이 나타나도록 테이블 컨테이너의 최대 너비 설정 */
}

.table {
	width: 100%;
	border-collapse: collapse; /* 셀 사이의 간격을 없애고 한 줄로 표시 */
}

.table th, .table td {
	border: 1px solid #ddd; /* 셀 경계선 설정 */
	padding: 8px;
	text-align: center;
	vertical-align: middle;
	white-space: nowrap; /* 글자가 너무 길어지면 줄바꿈을 하지 않도록 설정 */
	text-overflow: ellipsis; /* 글자가 너무 길 경우 ...으로 생략 */
}

.table th {
	background-color: #f2f2f2; /* 헤더 배경색 설정 */
}

.table tbody tr:nth-child(even) {
	background-color: #f9f9f9; /* 짝수 행 배경색 설정 */
}

.table tbody tr:hover {
	background-color: #e9f5f9; /* 마우스 호버 시 배경색 변경 */
}

/* 페이지네이션 스타일 */
.pagination {
	justify-content: center;
	margin-top: 20px;
}

.pagination .page-link {
	color: #007bff;
	background-color: #fff;
	border: 1px solid #dee2e6;
}

.pagination .page-link:hover {
	color: #0056b3;
	background-color: #e9ecef;
	border-color: #dee2e6;
}

.pagination .page-item.active .page-link {
	z-index: 1;
	color: #fff;
	background-color: #007bff;
	border-color: #007bff;
}
</style>
</head>
<body>

	<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
		<a class="navbar-brand" href="#">정책 관리</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse"
			data-target="#navbarSupportedContent"
			aria-controls="navbarSupportedContent" aria-expanded="false"
			aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav ml-auto">
				<li class="nav-item"><a class="nav-link" href="/patternlog"><i
						class="fas fa-file-alt mr-1"></i>로그 관리</a></li>
				<li class="nav-item"><a class="nav-link" href="/userlist"><i
						class="fas fa-users-cog"></i> 사용자 관리</a></li>
				<li class="nav-item"><a class="nav-link" href="/admin"><i
						class="fas fa-user-cog"></i> 관리자</a></li>
				<li class="nav-item"><a class="nav-link" href="/dashboard"><i
						class="fas fa-home"></i> 홈</a></li>
				<li class="nav-item"><a class="nav-link" href="/signin"><i
						class="fas fa-sign-out-alt"></i> 로그아웃</a></li>
			</ul>
		</div>
	</nav>
	<div class="sidebar">
		<h5 class="sidebar-heading">메뉴</h5>
		<ul class="nav flex-column nav-sidebar">
			<li class="nav-item"><a class="nav-link nav-link-custom"
				href="/patternlist"><i class="fas fa-shield-alt mr-1"></i> 패턴 정책
					리스트</a></li>
			<li class="nav-item"><a class="nav-link" href="/behaviorpolicy"><i
					class="fas fa-shield-alt mr-1"></i> 행동 정책 리스트</a></li>
			<li class="nav-item"><a class="nav-link" href="/addpolicy"><i
					class="fas fa-plus"></i> 패턴 정책 추가</a></li>
			<li class="nav-item"><a class="nav-link " href="/modifypolicy"><i
					class=" fas fa-edit mr-1"></i> 패턴 정책 수정</a></li>
			<li class="nav-item"><a class="nav-link " href="/deletepolicy"><i
					class="fas fa-trash-alt"></i> 패턴 정책 삭제</a></li>
		</ul>
	</div>
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-md-12">
				<div class="card">
					<div class="card-body">
						<div class="body-section">
							 <h5 style="text-align: center;  margin-bottom:30px; margin-right:100px;  font-size: 25px;">패턴 정책</h5>
<!-- 검색 섹션 -->
<div class="input-group mb-3 search-section">
    <input type="text" id="detectionNumber" class="form-control search-input" placeholder="NO">
    <input type="text" id="sToIp" class="form-control search-input" placeholder="s_to_ip">
    <input type="text" id="sIp" class="form-control search-input" placeholder="출발지IP">
    <input type="text" id="sPort" class="form-control search-input" placeholder="출발지Port">
    <input type="text" id="dIp" class="form-control search-input" placeholder="도착지IP">
    <input type="text" id="dPort" class="form-control search-input" placeholder="도착지Port">
    <input type="text" id="createDt" class="form-control search-input" placeholder="생성일자">
    <input type="text" id="modifyDt" class="form-control search-input" placeholder="수정일자">
    <input type="text" id="actionType" class="form-control search-input" placeholder="액션 타입">
    <input type="text" id="policyName" class="form-control search-input" placeholder="정책 이름">
    <input type="text" id="policyInfo" class="form-control search-input" placeholder="정책 정보">
    <input type="text" id="pattern1" class="form-control search-input" placeholder="패턴 1">
    <input type="text" id="pattern2" class="form-control search-input" placeholder="패턴 2">
    <input type="text" id="pattern3" class="form-control search-input" placeholder="패턴 3">
    <input type="text" id="dangerous" class="form-control search-input" placeholder="위험성">

    <div class="input-group-append">
        <button class="btn btn-primary" type="button" id="btnSearch">Search</button>
        <button class="btn btn-secondary" type="button" id="btnClear">Clear</button>
    </div>
</div>

<!-- 테이블 데이터 -->
<div class="table-container">
    <table id="patternTable" class="table table-bordered">
        <thead>
            <tr>
                <th>NO</th>
                <th>S_to_IP</th>
                <th>출발지IP</th>
                <th>출발지Port</th>
                <th>도착지IP</th>
                <th>도착지Port</th>
                <th>생성일자</th>
                <th>수정일자</th>
                <th>액션 타입</th>
                <th>정책 이름</th>
                <th>정책 정보</th>
                <th>패턴 1</th>
                <th>패턴 2</th>
                <th>패턴 3</th>
                <th>위험성</th>
            </tr>
        </thead>
        <tbody id="logTableBody">
										<!-- 검색 결과가 동적으로 추가될 자리 -->
									</tbody>
								</table>

								<!-- 페이지네이션 -->
								<nav>
									<ul class="pagination justify-content-center" id="pagination"></ul>
								</nav>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- JavaScript 라이브러리 및 사용자 정의 스크립트 -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
$(document).ready(function () {
    let currentPage = 1;
    const rowsPerPage = 10; // 페이지당 표시할 데이터 수

    // 페이지네이션 설정 함수
    function setupPagination(totalPages) {
        let paginationHTML = "";

        for (let i = 1; i <= totalPages; i++) {
            paginationHTML += `<li class="page-item ${i === currentPage ? 'active' : ''}"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
        }

        $("#pagination").html(paginationHTML);

        // 페이지 링크 클릭 이벤트 처리
        $("#pagination a.page-link").click(function (e) {
            e.preventDefault();
            currentPage = parseInt($(this).attr("data-page"));
            fetchAndDisplayPatterns(); // 페이지 번호에 따라 데이터 다시 가져오기
        });
    }

    // 데이터 가져와서 테이블에 표시하는 함수
    function fetchAndDisplayPatterns(searchCriteria = {}) {
        $.ajax({
            type: "POST",
            url: "/api/search-pattern-detections", // 실제 API 엔드포인트 주소로 변경해야 함
            contentType: "application/json",
            data: JSON.stringify(searchCriteria),
            success: function (data) {
                // 검색 결과 처리
                $("#logTableBody").empty();

                data.forEach(function (pattern) {
                    $("#logTableBody").append(
                        `<tr>
                            <td>${pattern.detection_number}</td>
                            <td>${pattern.s_to_ip}</td>
                            <td>${pattern.s_ip}</td>
                            <td>${pattern.s_port}</td>
                            <td>${pattern.d_ip}</td>
                            <td>${pattern.d_port}</td>
                            <td>${pattern.create_dt}</td>
                            <td>${pattern.modify_dt}</td>
                            <td>${pattern.action_type}</td>
                            <td>${pattern.policy_name}</td>
                            <td>${pattern.policy_info}</td>
                            <td>${pattern.pattern_1}</td>
                            <td>${pattern.pattern_2}</td>
                            <td>${pattern.pattern_3}</td>
                            <td>${pattern.dangerous}</td>
                        </tr>`
                    );
                });

                // 페이지네이션 설정
                setupPagination(data.totalPages);
            },
            error: function (err) {
                console.log(err);
                alert("서버에서 데이터를 가져오는 중 오류가 발생했습니다.");
            }
        });
    }

    // 페이지 로드 시 초기 데이터 가져오기
    fetchAndDisplayPatterns();

    // 검색 버튼 클릭 이벤트 리스너
    $("#btnSearch").click(function () {
        handleSearch();
    });

    // 초기화 버튼 클릭 이벤트 처리
    $("#btnClear").click(function () {
        $(".search-section input[type='text']").val("");
        fetchAndDisplayPatterns(); // 검색 기준을 초기화하고 모든 패턴을 가져옵니다.
    });

    // 검색 처리 함수
    function handleSearch() {
        let searchCriteria = {};
        $(".search-input").each(function () {
            let id = $(this).attr("id");
            let value = $(this).val().trim();
            if (value !== "") {
                searchCriteria[id] = value;
            }
        });

        fetchAndDisplayPatterns(searchCriteria); // 검색 조건을 서버로 전송
    }
});
</script>

</body>
</html>